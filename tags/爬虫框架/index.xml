<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>çˆ¬è™«æ¡†æ¶ on Lao&#39;s Blog</title>
    <link>https://laoooo.cn/tags/%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6/</link>
    <description>Recent content in çˆ¬è™«æ¡†æ¶ on Lao&#39;s Blog</description>
    <image>
      <url>https://laoooo.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://laoooo.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Fri, 26 Nov 2021 11:03:01 +0000</lastBuildDate><atom:link href="https://laoooo.cn/tags/%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Scrapy æ¡†æ¶å­¦ä¹ è®°å½•ï¼ˆè±†ç“£ï¼‰</title>
      <link>https://laoooo.cn/scrapy-%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E8%B1%86%E7%93%A3/</link>
      <pubDate>Fri, 26 Nov 2021 11:03:01 +0000</pubDate>
      
      <guid>https://laoooo.cn/scrapy-%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E8%B1%86%E7%93%A3/</guid>
      <description>Scrapy è±†ç“£çˆ¬è™« å®‰è£… ä¸‹åˆ—çš„å®‰è£…æ­¥éª¤å‡å®šæ‚¨å·²ç»å®‰è£…å¥½ä¸‹åˆ—ç¨‹åº: Python 2.7æˆ–ä»¥ä¸Šç‰ˆæœ¬ Python Package: pip and setuptools. ç°åœ¨ pip ä¾èµ– setuptools ï¼Œå¦‚æœæœªå®‰è£…ï¼Œåˆ™ä¼šè‡ªåŠ¨å®‰è£… setuptools ã€‚ lxml. å¤§å¤šæ•°Linu</description>
      <content:encoded><![CDATA[<h1 id="scrapy-è±†ç“£çˆ¬è™«">Scrapy è±†ç“£çˆ¬è™«</h1>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>ä¸‹åˆ—çš„å®‰è£…æ­¥éª¤å‡å®šæ‚¨å·²ç»å®‰è£…å¥½ä¸‹åˆ—ç¨‹åº:</p>
<ul>
<li><a href="http://www.python.org/">Python</a> 2.7æˆ–ä»¥ä¸Šç‰ˆæœ¬</li>
<li>Python Package: <a href="http://www.pip-installer.org/en/latest/installing.html">pip</a> and <a href="https://pypi.python.org/pypi/setuptools">setuptools</a>. ç°åœ¨ <a href="http://www.pip-installer.org/en/latest/installing.html">pip</a> ä¾èµ– <a href="https://pypi.python.org/pypi/setuptools">setuptools</a> ï¼Œå¦‚æœæœªå®‰è£…ï¼Œåˆ™ä¼šè‡ªåŠ¨å®‰è£… <a href="https://pypi.python.org/pypi/setuptools">setuptools</a> ã€‚</li>
<li><a href="http://lxml.de/">lxml</a>. å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆè‡ªå¸¦äº†lxmlã€‚å¦‚æœç¼ºå¤±ï¼Œè¯·æŸ¥çœ‹http://lxml.de/installation.html</li>
<li><a href="https://pypi.python.org/pypi/pyOpenSSL">OpenSSL</a>. é™¤äº†Windows(è¯·æŸ¥çœ‹ <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/intro/install.html#intro-install-platform-notes">å¹³å°å®‰è£…æŒ‡å—</a>)ä¹‹å¤–çš„ç³»ç»Ÿéƒ½å·²ç»æä¾›ã€‚</li>
</ul>
<p>æ‚¨å¯ä»¥ä½¿ç”¨pipæ¥å®‰è£…Scrapy(æ¨èä½¿ç”¨pipæ¥å®‰è£…Python package).</p>
<p>ä½¿ç”¨pipå®‰è£…:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install Scrapy
</span></span></code></pre></div><h2 id="åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</h2>
<p>åˆ›å»ºä¸€ä¸ªscrapyçˆ¬è™«é¡¹ç›®å’Œä¸€èˆ¬çš„pythonæ¡†æ¶ä¸€æ ·ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯å¿«é€Ÿåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">scrapy startproject é¡¹ç›®åç§°
</span></span></code></pre></div><p>è¯¥å‘½ä»¤æˆåŠŸæ‰§è¡Œåï¼Œåº”åŒ…å«å¦‚ä¸‹ç›®å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">doodlexu@MacBook tutorial % tree
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">â”œâ”€â”€ scrapy.cfg
</span></span><span class="line"><span class="cl">â””â”€â”€ tutorial
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ items.py
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ middlewares.py
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ pipelines.py
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ settings.py
</span></span><span class="line"><span class="cl">    â””â”€â”€ spiders
</span></span><span class="line"><span class="cl">        â””â”€â”€ __init__.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">2</span> directories, <span class="m">7</span> files
</span></span></code></pre></div><p>è¿™äº›æ–‡ä»¶åˆ†åˆ«æ˜¯:</p>
<ul>
<li><code>scrapy.cfg</code>: é¡¹ç›®çš„é…ç½®æ–‡ä»¶</li>
<li><code>tutorial/</code>: è¯¥é¡¹ç›®çš„pythonæ¨¡å—ã€‚ä¹‹åæ‚¨å°†åœ¨æ­¤åŠ å…¥ä»£ç ã€‚</li>
<li><code>tutorial/items.py</code>: é¡¹ç›®ä¸­çš„itemæ–‡ä»¶.</li>
<li><code>tutorial/pipelines.py</code>: é¡¹ç›®ä¸­çš„pipelinesæ–‡ä»¶.</li>
<li><code>tutorial/settings.py</code>: é¡¹ç›®çš„è®¾ç½®æ–‡ä»¶.</li>
<li><code>tutorial/spiders/</code>: æ”¾ç½®spiderä»£ç çš„ç›®å½•.</li>
</ul>
<h2 id="å®šä¹‰item">å®šä¹‰Item</h2>
<blockquote>
<p>Itemæ˜¯çˆ¬å–åˆ°çš„æ•°æ®çš„å®¹å™¨ï¼Œä»–çš„è¯­æ³•å¾ˆç®€å•ï¼Œå’Œpythonå­—å…¸ï¼ˆdictï¼‰ç±»ä¼¼ï¼Œå¹¶ä¸”æä¾›äº†é¢å¤–ä¿æŠ¤æœºåˆ¶æ¥é¿å…æ‹¼å†™é”™è¯¯å¯¼è‡´çš„æœªå®šä¹‰å­—æ®µé”™è¯¯ã€‚</p>
</blockquote>
<p>ç±»ä¼¼åœ¨ORMä¸­åšçš„ä¸€æ ·ï¼Œæ‚¨å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/items.html#scrapy.item.Item"><code>scrapy.Item</code></a>ç±»ï¼Œ å¹¶ä¸”å®šä¹‰ç±»å‹ä¸º <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/items.html#scrapy.item.Field"><code>scrapy.Field</code></a> çš„ç±»å±æ€§æ¥å®šä¹‰ä¸€ä¸ªItemã€‚å…¶å†™æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">scrapy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">douban_shortItem</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Item</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">votes</span>   <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>  <span class="c1"># æœ‰ç”¨æŠ•ç¥¨</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span>      <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>  <span class="c1"># ç”¨æˆ·ID</span>
</span></span><span class="line"><span class="cl">    <span class="n">rating</span>  <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>  <span class="c1"># ç”¨æˆ·æ‰“åˆ†</span>
</span></span><span class="line"><span class="cl">    <span class="n">date</span>    <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>  <span class="c1"># çŸ­è¯„æ—¥æœŸ</span>
</span></span><span class="line"><span class="cl">    <span class="n">content</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>  <span class="c1"># çŸ­è¯„å†…å®¹</span>
</span></span></code></pre></div><h2 id="ç¼–å†™çˆ¬è™«">ç¼–å†™çˆ¬è™«</h2>
<p>Spideræ˜¯ç”¨æˆ·ç¼–å†™ç”¨äºä»å•ä¸ªç½‘ç«™(æˆ–è€…ä¸€äº›ç½‘ç«™)çˆ¬å–æ•°æ®çš„ç±»ã€‚</p>
<p>å…¶åŒ…å«äº†ä¸€ä¸ªç”¨äºä¸‹è½½çš„åˆå§‹URLï¼Œå¦‚ä½•è·Ÿè¿›ç½‘é¡µä¸­çš„é“¾æ¥ä»¥åŠå¦‚ä½•åˆ†æé¡µé¢ä¸­çš„å†…å®¹ï¼Œ æå–ç”Ÿæˆ <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/items.html#topics-items">item</a> çš„æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªSpiderï¼Œæ‚¨å¿…é¡»ç»§æ‰¿ <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/spiders.html#scrapy.spider.Spider"><code>scrapy.Spider</code></a> ç±»ï¼Œ ä¸”å®šä¹‰ä»¥ä¸‹ä¸‰ä¸ªå±æ€§:</p>
<ul>
<li><a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/spiders.html#scrapy.spider.Spider.name"><code>name</code></a>: ç”¨äºåŒºåˆ«Spiderã€‚ è¯¥åå­—å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œæ‚¨ä¸å¯ä»¥ä¸ºä¸åŒçš„Spiderè®¾å®šç›¸åŒçš„åå­—ã€‚</li>
<li><a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/spiders.html#scrapy.spider.Spider.start_urls"><code>start_urls</code></a>: åŒ…å«äº†Spideråœ¨å¯åŠ¨æ—¶è¿›è¡Œçˆ¬å–çš„urlåˆ—è¡¨ã€‚ å› æ­¤ï¼Œç¬¬ä¸€ä¸ªè¢«è·å–åˆ°çš„é¡µé¢å°†æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ åç»­çš„URLåˆ™ä»åˆå§‹çš„URLè·å–åˆ°çš„æ•°æ®ä¸­æå–ã€‚</li>
<li><a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/spiders.html#scrapy.spider.Spider.parse"><code>parse()</code></a> æ˜¯spiderçš„ä¸€ä¸ªæ–¹æ³•ã€‚ è¢«è°ƒç”¨æ—¶ï¼Œæ¯ä¸ªåˆå§‹URLå®Œæˆä¸‹è½½åç”Ÿæˆçš„ <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/request-response.html#scrapy.http.Response"><code>Response</code></a> å¯¹è±¡å°†ä¼šä½œä¸ºå”¯ä¸€çš„å‚æ•°ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚ è¯¥æ–¹æ³•è´Ÿè´£è§£æè¿”å›çš„æ•°æ®(response data)ï¼Œæå–æ•°æ®(ç”Ÿæˆitem)ä»¥åŠç”Ÿæˆéœ€è¦è¿›ä¸€æ­¥å¤„ç†çš„URLçš„ <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/request-response.html#scrapy.http.Request"><code>Request</code></a> å¯¹è±¡ã€‚</li>
</ul>
<p>ä»¥ä¸‹ä¸ºæˆ‘ä»¬çš„Spiderä»£ç ï¼Œå®ƒçš„ç›®æ ‡æ˜¯çˆ¬å–ç”µå½±ï¼ˆæ¯’æ¶²2ï¼‰çš„é¦–é¡µçŸ­è¯„ï¼Œå¹¶ä¿å­˜ã€‚ä»£ç éœ€æ”¾åœ¨ <code>tutorial/spiders</code> ç›®å½•ä¸‹çš„ <code>douban_short.py</code> æ–‡ä»¶ä¸­:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">scrapy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">mySpider.items</span> <span class="kn">import</span> <span class="n">douban_shortItem</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DoubanShortSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;douban_short&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;douban.com&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;your_cookies&#39;</span> <span class="o">=</span> <span class="s1">&#39;your_values&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://movie.douban.com/subject/30382416/comments&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">item</span> <span class="o">=</span> <span class="n">douban_shortItem</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">shorts</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&#34;comments&#34;]/div&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">short</span> <span class="ow">in</span> <span class="n">shorts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;votes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;.//div[2]/h3/span[1]/span/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;.//div[2]/h3/span[2]/a/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;.//div[2]/h3/span[2]/span[2]/@class&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">re</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;\d&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;.//div[2]/h3/span[2]/span[3]/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;.//div[2]/p/span/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">yield</span> <span class="n">item</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span></code></pre></div><p>åœ¨çˆ¬å–è±†ç“£çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°cookiesè¿™é¡¹æŠ€æœ¯ï¼Œå®ƒå¯ä»¥å¸®åŠ©æœåŠ¡å™¨è®¤è¯†ä½ æ˜¯è°ï¼Œç»™æˆ‘ä»¬çš„å°èœ˜è››æä¾›ä¸€å±‚æ©æŠ¤ï¼Œè¿™æ ·ä»–å°±ä¸ä¼šæ‹’ç»æä¾›æ•°æ®äº†ã€‚</p>
<p>å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯æˆ‘ä»¬çš„headersï¼Œå®ƒçš„ä½œç”¨ä¹Ÿå’Œcookiesç±»ä¼¼ï¼Œä¸è¿‡å®ƒä¸å…·å¤‡æ ‡è¯†åˆ°ä¸ªäººï¼Œè€Œæ˜¯æ ‡è¯†ä½ ç”¨çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æµè§ˆå™¨å’Œè®¾å¤‡ï¼Œä»¥ç¡®ä¿èƒ½æ­£ç¡®è§£ç ã€‚</p>
<p>è¿™ä¸¤é¡¹å‚æ•°éƒ½å¯ä»¥åœ¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ä¸­æ‰¾åˆ°ï¼Œç›¸ä¿¡èªæ˜çš„ä½ ä¸€å®šå¯ä»¥çš„ğŸ¤ª</p>
<h3 id="è‡ªåŠ¨ç¿»é¡µ">è‡ªåŠ¨ç¿»é¡µ</h3>
<p>çœ‹åˆ°è¿™ï¼Œä½ è‚¯å®šä¹Ÿå‘ç°äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ä¸ªå°èœ˜è››è™½ç„¶å¹²å¾—å¾ˆä¸é”™ï¼Œé¡ºåˆ©çš„æ‹¿åˆ°äº†æ•°æ®ï¼Œä½†è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦æ‰€æœ‰æ•°æ®ã€‚ä½†æ˜¯è±†ç“£ä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒï¼Œåšäº†åˆ†é¡µå¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<blockquote>
<p>ä½ å·²ç»æ˜¯ä¸ªæˆç†Ÿçš„ğŸ•·ï¸äº†ï¼Œä½ å¾—å­¦ä¼šè‡ªå·±ç¿»é¡µ</p>
</blockquote>
<p>å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ­£å¸¸é€šè¿‡æµè§ˆå™¨è®¿é—®çš„æ—¶å€™ï¼Œçœ‹ä¸‹ä¸€é¡µæ˜¯é€šè¿‡ç‚¹å‡»æ¬¡é¡µæŒ‰é’®æ¥å®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„èœ˜è››ä¹Ÿå¯ä»¥è¿™ä¹ˆåšã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡xpathæ¥å®šä½åˆ°ä¸‹ä¸€é¡µæŒ‰é’®çš„ç›®æ ‡çš„URLï¼Œå¹¶ä¸”åªè¦å®ƒå­˜åœ¨ï¼Œæˆ‘ä»¬å°±ç»§ç»­æ”¾ğŸ•·ï¸ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">next_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;paginator&#34;]/a[@class=&#34;next&#34;]/@href&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_url</span> <span class="o">=</span> <span class="s1">&#39;https://movie.douban.com/subject/30382416/comments&#39;</span> <span class="o">+</span> <span class="n">next_url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">next_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
</span></span></code></pre></div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥éå†æ‰€æœ‰çš„è¯„è®ºäº†ã€‚</p>
<h2 id="çˆ¬å–">çˆ¬å–</h2>
<p>è¿›å…¥é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤å¯åŠ¨spider:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">scrapy crawl douban_short
</span></span></code></pre></div><p>å‘½ä»¤æ‰§è¡Œåä¼šæœ‰ä¸€å¤§å †<code>è°ƒè¯•</code>æ—¥å¿—è¾“å‡ºï¼Œåˆ«ç´§å¼ ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚ä½ å¯ä»¥åœ¨setting.pyé‡Œéšæ„è°ƒæ•´æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="c1"># æ—¥å¿—è¾“å‡ºçº§åˆ«</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></div><h3 id="ä¿å­˜">ä¿å­˜</h3>
<p>æ‰§è¡Œä¸Šé¢å‘½ä»¤ä¼šçˆ¬ï¼Œä½†ä¸ä¼šå­˜ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¸€ä¸ª<code>-O</code>çš„å‚æ•°æ¥æŒ‡å®šä¿å­˜çš„æ–‡ä»¶åä»¥åŠæ ¼å¼ï¼Œæ¯”å¦‚åƒè¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">scrapy crawl douban_short -O shorts.csv
</span></span></code></pre></div><p>ä»–ä¼šå°†ä¿å­˜åˆ°itemé‡Œé¢çš„æ•°æ®ä¿å­˜åˆ°shorts.cvsæ–‡ä»¶é‡Œï¼Œè€Œä¸”scrapyä¼šè‡ªåŠ¨è¾¨åˆ«ä½ çš„æ–‡ä»¶æ ¼å¼ï¼Œè‡ªåŠ¨çš„è§£æå¹¶ä¿å­˜ã€‚å®ƒæ”¯æŒçš„æ ¼å¼æœ‰ï¼š</p>
<ul>
<li>json</li>
<li>jsonlines</li>
<li>jl</li>
<li>csv</li>
<li>xml</li>
<li>marshal</li>
<li>pickle</li>
</ul>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
